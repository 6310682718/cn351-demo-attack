<!DOCTYPE html>
<html lang="en">

<head>
    <script src="https://cdn.ckeditor.com/4.21.0/standard/ckeditor.js"></script>
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
</head>

<body>
    <%- include('header.ejs') %>
    <div class="container">
        <h1 class="mt-5 text-center">Create Your Post</h1>
        <form class="mt-5" action="/create-post" method="post" id="createPostForm">
            <div class="mb-3">
                <label for="title" class="form-label">Title</label>
                <input type="text" class="form-control" id="title" placeholder="Title" name="title">
            </div>
            <textarea id="editor1" name="editor1">
                <p>This is the editor content.</p>
            </textarea>

            <script src="../node_modules/ckeditor4/ckeditor.js"></script>
            <script>
                var editor = CKEDITOR.replace('editor1');
                CKFinder.setupCKEditor(editor);
                CKEDITOR.config.allowedContent = true;
                CKEDITOR.config.fullPage = true;
            </script>
            <div class="d-grid gap-2 col-6 mx-auto mt-3">
                <button class="btn btn-success" type="submit">Submit</button>
            </div>
        </form>
    </div>

    <script>
        const createPostForm = document.getElementById("createPostForm");
        document.getElementById("createPostForm").addEventListener("submit", async function (event) {
            event.preventDefault(); // Prevent form submission
            
            const formData = new FormData(createPostForm);
            const title = formData.get("title");
            const editor1 = formData.get("editor1");
            try {
                // Perform AJAX request
                const response = await fetch("/create-post", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({ title, editor1 }),
                });

                if (response.ok) {
                    const data = await response.json();
                    if (data.success) {
                        // Show success message
                        swal("Success", "Post created successfully!", "success")
                            .then(() => {
                                // Redirect to a new page or perform any additional action
                                window.location.href = "/"; // Redirect to home page
                            });
                    } else {
                        // Show error message
                        swal("Error", "An error occurred while creating the post.", "error");
                    }
                } else {
                    throw new Error("Request failed with status: " + response.status);
                }
            } catch (error) {
                console.error(error);
                // Show error message
                swal("Error", "An error occurred while creating the post.", "error");
            }
        });
    </script>
</body>

</html>
